<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>阿SFAG的个人博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="第九节：springboot集成redis及使用pom依赖123456789&lt;dependency&gt;    &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;&#x2F;artifactId&gt;&lt;&#x2F;dependenc">
<meta property="og:type" content="article">
<meta property="og:title" content="阿SFAG的个人博客">
<meta property="og:url" content="http://example.com/2022/06/26/%E7%AC%AC%E4%B9%9D%E8%8A%82%EF%BC%9Aspringboot%E9%9B%86%E6%88%90redis%E5%8F%8A%E4%BD%BF%E7%94%A8/index.html">
<meta property="og:site_name" content="阿SFAG的个人博客">
<meta property="og:description" content="第九节：springboot集成redis及使用pom依赖123456789&lt;dependency&gt;    &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;&#x2F;artifactId&gt;&lt;&#x2F;dependenc">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-06-26T14:10:59.801Z">
<meta property="article:modified_time" content="2021-07-25T12:16:05.721Z">
<meta property="article:author" content="shangguandanyu">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="阿SFAG的个人博客" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">阿SFAG的个人博客</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-第九节：springboot集成redis及使用" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/06/26/%E7%AC%AC%E4%B9%9D%E8%8A%82%EF%BC%9Aspringboot%E9%9B%86%E6%88%90redis%E5%8F%8A%E4%BD%BF%E7%94%A8/" class="article-date">
  <time class="dt-published" datetime="2022-06-26T14:10:59.801Z" itemprop="datePublished">2022-06-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="第九节：springboot集成redis及使用"><a href="#第九节：springboot集成redis及使用" class="headerlink" title="第九节：springboot集成redis及使用"></a>第九节：springboot集成redis及使用</h1><h2 id="pom依赖"><a href="#pom依赖" class="headerlink" title="pom依赖"></a>pom依赖</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- 使用lettuce做redis的连接池需要额外引入这个包--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;commons-pool2&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h2 id="application-配置"><a href="#application-配置" class="headerlink" title="application 配置"></a><strong>application 配置</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># Redis 数据库索引（默认为 0）</span><br><span class="line">spring.redis.database=0</span><br><span class="line"># Redis 服务器地址</span><br><span class="line">spring.redis.host=localhost</span><br><span class="line"># Redis 服务器连接端口</span><br><span class="line">spring.redis.port=6379</span><br><span class="line"># Redis 服务器连接密码（默认为空）</span><br><span class="line">spring.redis.password=</span><br><span class="line"># 连接池最大连接数（使用负值表示没有限制） 默认 8</span><br><span class="line">spring.redis.lettuce.pool.max-active=8</span><br><span class="line"># 连接池最大阻塞等待时间（使用负值表示没有限制） 默认 -1</span><br><span class="line">spring.redis.lettuce.pool.max-wait=-1</span><br><span class="line"># 连接池中的最大空闲连接 默认 8</span><br><span class="line">spring.redis.lettuce.pool.max-idle=8</span><br><span class="line"># 连接池中的最小空闲连接 默认 0</span><br><span class="line">spring.redis.lettuce.pool.min-idle=0</span><br></pre></td></tr></table></figure>

<p> 集群配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.redis.cluster.nodes=10.10.0.48:7001,10.10.0.48:7001,10.10.0.48:8000,10.10.0.48:8001,10.10.0.48:9000,10.10.0.48:9001</span><br></pre></td></tr></table></figure>

<h2 id="RedisTemplate序列化"><a href="#RedisTemplate序列化" class="headerlink" title="RedisTemplate序列化"></a>RedisTemplate序列化</h2><p>默认情况下的模板只能支持 <code>RedisTemplate&lt;String,String&gt;</code>，只能存入字符串，很多时候，我们需要自定义 RedisTemplate ，设置序列化器，这样我们可以很方便的操作实例对象</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class RedisConfig &#123;</span><br><span class="line">    @Bean</span><br><span class="line">    public RedisTemplate&lt;String, Serializable&gt; redisTemplate(LettuceConnectionFactory lettuceConnectionFactory) &#123;</span><br><span class="line">        RedisTemplate&lt;String, Serializable&gt; redisTemplate = new RedisTemplate&lt;&gt;();</span><br><span class="line">        redisTemplate.setKeySerializer(new StringRedisSerializer());</span><br><span class="line">        redisTemplate.setValueSerializer(new GenericJackson2JsonRedisSerializer());</span><br><span class="line">        redisTemplate.setConnectionFactory(lettuceConnectionFactory);</span><br><span class="line">        return redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="operation接口"><a href="#operation接口" class="headerlink" title="operation接口"></a>operation接口</h2><ul>
<li>ValueOperations：简单K-V操作</li>
<li>ListOperations：针对list类型的数据操作</li>
<li>HashOperations：针对map类型的数据操作</li>
<li>SetOperations：set类型数据操作</li>
<li>ZSetOperations：zset类型数据操作</li>
</ul>
<h3 id="ValueOperations–String类型"><a href="#ValueOperations–String类型" class="headerlink" title="ValueOperations–String类型"></a>ValueOperations–String类型</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line">package com.odianyun.internship;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.JSONObject;</span><br><span class="line">import com.google.common.collect.ImmutableMap;</span><br><span class="line">import com.odianyun.internship.model.UUser;</span><br><span class="line">import com.odianyun.internship.startup.Application;</span><br><span class="line">import org.assertj.core.util.Lists;</span><br><span class="line">import org.junit.Test;</span><br><span class="line">import org.junit.runner.RunWith;</span><br><span class="line">import org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line">import org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line">import org.springframework.data.redis.core.ValueOperations;</span><br><span class="line">import org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line">import java.io.Serializable;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.concurrent.TimeUnit;</span><br><span class="line">import java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @description:</span><br><span class="line"> * @author: EDZ</span><br><span class="line"> * @time: 14:16</span><br><span class="line"> * @date: 2021/7/20</span><br><span class="line"> */</span><br><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@SpringBootTest(classes = Application.class)</span><br><span class="line">public class RedisTest &#123;</span><br><span class="line"></span><br><span class="line">    @Resource</span><br><span class="line">    private RedisTemplate&lt;String, Serializable&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testStringSet() &#123;</span><br><span class="line">        ValueOperations operations = redisTemplate.opsForValue();</span><br><span class="line">        // 设值</span><br><span class="line">        String key = &quot;userName:2&quot;;</span><br><span class="line">        operations.set(key, &quot;xingguo&quot;);</span><br><span class="line">        // 使用最后一个</span><br><span class="line">        operations.set(key, &quot;xingguo123&quot;);</span><br><span class="line">        // 获取值</span><br><span class="line">        System.out.println(&quot;value = &quot; + operations.get(key));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testStringExpire() throws InterruptedException &#123;</span><br><span class="line">        ValueOperations operations = redisTemplate.opsForValue();</span><br><span class="line">        String key = &quot;userCaptchas:1&quot;;</span><br><span class="line">        // 设置过期时间</span><br><span class="line">        operations.set(key, &quot;435678&quot;, 3, TimeUnit.SECONDS);</span><br><span class="line">        System.out.println(&quot;value = &quot; + operations.get(key));</span><br><span class="line">        Thread.sleep(4000);</span><br><span class="line">        System.out.println(&quot;4s之后value = &quot; + operations.get(key));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testStringSetIfAbsent() throws InterruptedException &#123;</span><br><span class="line">        ValueOperations operations = redisTemplate.opsForValue();</span><br><span class="line">        String key = &quot;userName:2&quot;;</span><br><span class="line">        String key3 = &quot;userName:3&quot;;</span><br><span class="line">        String key6 = &quot;userName:6&quot;;</span><br><span class="line">        // 如果不存在，则设置一个key和value。如果存在则不改变</span><br><span class="line">        operations.setIfAbsent(key, &quot;diaoxingguo2&quot;);</span><br><span class="line">        operations.setIfAbsent(key3, &quot;diaoxingguo3&quot;);</span><br><span class="line">        operations.setIfAbsent(key6, &quot;diaoxingguo6&quot;);</span><br><span class="line">        System.out.println(&quot;key value = &quot; + operations.get(key));</span><br><span class="line">        System.out.println(&quot;key3 value = &quot; + operations.get(key3));</span><br><span class="line">        System.out.println(&quot;key6 value = &quot; + operations.get(key6));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testStringSetIfPresent() throws InterruptedException &#123;</span><br><span class="line">        ValueOperations operations = redisTemplate.opsForValue();</span><br><span class="line">        String key = &quot;userName:2&quot;;</span><br><span class="line">        String key3 = &quot;userName:3&quot;;</span><br><span class="line">        String key8 = &quot;userName:8&quot;;</span><br><span class="line">        // 如果key存在就使用新值覆盖，如果key不存在，则不赋值</span><br><span class="line">        operations.setIfPresent(key, &quot;diaoxingguo2&quot;);</span><br><span class="line">        operations.setIfPresent(key3, &quot;diaoxingguo3&quot;);</span><br><span class="line">        operations.setIfPresent(key8, &quot;diaoxingguo8&quot;);</span><br><span class="line">        System.out.println(&quot;key value = &quot; + operations.get(key));</span><br><span class="line">        System.out.println(&quot;key3 value = &quot; + operations.get(key3));</span><br><span class="line">        System.out.println(&quot;key8 value = &quot; + operations.get(key8));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testStringMultiSet() &#123;</span><br><span class="line">        ValueOperations operations = redisTemplate.opsForValue();</span><br><span class="line">        // 批量设置key和value</span><br><span class="line">        Map&lt;String, String&gt; map = ImmutableMap.of(</span><br><span class="line">                &quot;userName:101&quot;, &quot;张三&quot;,</span><br><span class="line">                &quot;userName:102&quot;, &quot;李四&quot;,</span><br><span class="line">                &quot;userName:103&quot;, &quot;刘汝清&quot;</span><br><span class="line">        );</span><br><span class="line">        operations.multiSet(map);</span><br><span class="line">        // 获取单个key</span><br><span class="line">        System.out.println(&quot;userName:101 value = &quot; + operations.get(&quot;userName:101&quot;));</span><br><span class="line"></span><br><span class="line">        // 获取批量key的值</span><br><span class="line">        List&lt;String&gt; multiValues = operations.multiGet(Lists.newArrayList(&quot;userName:101&quot;, &quot;userName:102&quot;, &quot;userName:103&quot;));</span><br><span class="line"></span><br><span class="line">        multiValues.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; filterList = multiValues.stream().filter(item -&gt; !item.equals(&quot;张三&quot;)).collect(Collectors.toList());</span><br><span class="line">        System.out.println(&quot;filterList = &quot; + JSONObject.toJSONString(filterList));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testStringIncrement() &#123;</span><br><span class="line">        ValueOperations operations = redisTemplate.opsForValue();</span><br><span class="line">        String key = &quot;url:query:num&quot;;</span><br><span class="line">        Long maxNum = 10L;</span><br><span class="line">        Long num = 0L;</span><br><span class="line">        operations.set(key, 0);</span><br><span class="line">        while (maxNum.compareTo(num) &gt; 0) &#123;</span><br><span class="line">            // 加值</span><br><span class="line">            num = operations.increment(key);</span><br><span class="line">            System.out.println(&quot;num = &quot; + num);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testStringIncrementWithDelta() &#123;</span><br><span class="line">        ValueOperations operations = redisTemplate.opsForValue();</span><br><span class="line">        String key = &quot;url:query:num&quot;;</span><br><span class="line">        Long maxNum = 10L;</span><br><span class="line">        Long num = 0L;</span><br><span class="line">        Long delta = 2L;</span><br><span class="line">        operations.set(key, 0);</span><br><span class="line">        while (maxNum.compareTo(num) &gt; 0) &#123;</span><br><span class="line">            // 加值</span><br><span class="line">            num = operations.increment(key, delta);</span><br><span class="line">            System.out.println(&quot;num = &quot; + num);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testStringDecrement() &#123;</span><br><span class="line">        ValueOperations operations = redisTemplate.opsForValue();</span><br><span class="line">        String key = &quot;url:query:num&quot;;</span><br><span class="line">        Long minNum = 0L;</span><br><span class="line">        Long num = 10L;</span><br><span class="line">        Long delta = 2L;</span><br><span class="line">        operations.set(key, num);</span><br><span class="line">        while (num.compareTo(minNum) &gt; 0) &#123;</span><br><span class="line">            // 减值</span><br><span class="line">            num = operations.decrement(key, delta);</span><br><span class="line">            System.out.println(&quot;num = &quot; + num);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testStringGetAndSet() &#123;</span><br><span class="line">        ValueOperations operations = redisTemplate.opsForValue();</span><br><span class="line">        String key = &quot;url:query:num&quot;;</span><br><span class="line">        String key3 = &quot;url:query:num3&quot;;</span><br><span class="line">        // 设置新值返回旧值，如果key不存在，旧值就是null</span><br><span class="line">        /*System.out.println(&quot;getAndSet key value = &quot; + operations.get(key));</span><br><span class="line">        System.out.println(&quot;getAndSet key value = &quot; + operations.getAndSet(key, 1000));</span><br><span class="line">        System.out.println(&quot;getAndSet key value = &quot; + operations.get(key));</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;getAndSet key value = &quot; + operations.get(key3));</span><br><span class="line">        System.out.println(&quot;getAndSet key value = &quot; + operations.getAndSet(key3, 1000));</span><br><span class="line">        System.out.println(&quot;getAndSet key value = &quot; + operations.get(key3));*/</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;key3 value = &quot; + operations.get(key3));</span><br><span class="line">        // 判断key是否存在</span><br><span class="line">        System.out.println(&quot;hasKey key3 = &quot; + redisTemplate.hasKey(key3));</span><br><span class="line">        // 删除key</span><br><span class="line">        redisTemplate.delete(key3);</span><br><span class="line">        System.out.println(&quot;key3 value = &quot; + operations.get(key3));</span><br><span class="line">        System.out.println(&quot;hasKey key3 = &quot; + redisTemplate.hasKey(key3));</span><br><span class="line">        // 批量获取</span><br><span class="line">        System.out.println(JSONObject.toJSONString(operations.multiGet(Lists.newArrayList(key, key3))));</span><br><span class="line">        redisTemplate.delete(Lists.newArrayList(key, key3));</span><br><span class="line">        System.out.println(JSONObject.toJSONString(operations.multiGet(Lists.newArrayList(key, key3))));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="ValueOperations–Object类型"><a href="#ValueOperations–Object类型" class="headerlink" title="ValueOperations–Object类型"></a>ValueOperations–Object类型</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">    public void testObject() &#123;</span><br><span class="line">        ValueOperations&lt;String, Serializable&gt; operations = redisTemplate.opsForValue();</span><br><span class="line">        String key = &quot;userInfo:123&quot;;</span><br><span class="line">        UUser user = new UUser();</span><br><span class="line">        user.setId(123L);</span><br><span class="line">        user.setMobile(&quot;13127787865&quot;);</span><br><span class="line">        user.setPassword(&quot;123456&quot;);</span><br><span class="line"></span><br><span class="line">        // 存放对象</span><br><span class="line">        operations.set(key, user);</span><br><span class="line"></span><br><span class="line">        UUser cacheUUser = (UUser) operations.get(key);</span><br><span class="line"></span><br><span class="line">        System.out.println(JSONObject.toJSONString(cacheUUser));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> @Test</span><br><span class="line">public void testObj() throws InterruptedException &#123;</span><br><span class="line">    String key = &quot;user:1&quot;;</span><br><span class="line">    UUser user = new UUser();</span><br><span class="line">    user.setId(1L);</span><br><span class="line">    user.setMobile(&quot;13127787865&quot;);</span><br><span class="line">    user.setPassword(&quot;123456&quot;);</span><br><span class="line">    ValueOperations&lt;String, Serializable&gt; operations = redisTemplate.opsForValue();</span><br><span class="line">    // 设置过期时间2s</span><br><span class="line">    operations.set(key, user, 2, TimeUnit.SECONDS);</span><br><span class="line">    UUser userValue = (UUser) operations.get(key);</span><br><span class="line">    System.out.println(&quot;key = &quot; + redisTemplate.hasKey(key));</span><br><span class="line">    System.out.println(&quot;value = &quot; + JSONObject.toJSONString(userValue));</span><br><span class="line"></span><br><span class="line">    Thread.sleep(2500);</span><br><span class="line">    UUser userValue2 = (UUser) operations.get(key);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;key = &quot; + redisTemplate.hasKey(key));</span><br><span class="line">    System.out.println(&quot;value = &quot; + JSONObject.toJSONString(userValue2));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="redisTemplate删除"><a href="#redisTemplate删除" class="headerlink" title="redisTemplate删除"></a>redisTemplate删除</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testDelete() &#123;</span><br><span class="line">    String key = &quot;user:1&quot;;</span><br><span class="line">    UUser user = new UUser();</span><br><span class="line">    user.setId(1L);</span><br><span class="line">    user.setMobile(&quot;13127787865&quot;);</span><br><span class="line">    user.setPassword(&quot;123456&quot;);</span><br><span class="line">    ValueOperations&lt;String, Serializable&gt; operations = redisTemplate.opsForValue();</span><br><span class="line">    operations.set(key, user);</span><br><span class="line">    UUser userValue = (UUser) operations.get(key);</span><br><span class="line">    System.out.println(&quot;key = &quot; + redisTemplate.hasKey(key));</span><br><span class="line">    System.out.println(&quot;value = &quot; + JSONObject.toJSONString(userValue));</span><br><span class="line">    </span><br><span class="line">    // 删除</span><br><span class="line">    redisTemplate.delete(key);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;key = &quot; + redisTemplate.hasKey(key));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ListOperations"><a href="#ListOperations" class="headerlink" title="ListOperations"></a>ListOperations</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Long leftPush(K key, V value);</span><br><span class="line"> * 左边添加，list头部</span><br><span class="line"> */</span><br><span class="line">@Test</span><br><span class="line">public void testListPush() &#123;</span><br><span class="line">    ListOperations&lt;String, Serializable&gt; operations =redisTemplate.opsForList();</span><br><span class="line">    String key = &quot;user:fans:1&quot;;</span><br><span class="line"></span><br><span class="line">    // list头部</span><br><span class="line">    /*operations.leftPush(key, &quot;刘德华&quot;);</span><br><span class="line">    operations.leftPush(key, &quot;张学友&quot;);</span><br><span class="line">    operations.leftPush(key, &quot;郭富城&quot;);</span><br><span class="line">    operations.leftPush(key, &quot;黎明&quot;);</span><br><span class="line">    operations.leftPush(key, &quot;周杰伦&quot;);*/</span><br><span class="line"></span><br><span class="line">    // list尾部</span><br><span class="line">    operations.rightPush(key, &quot;王力宏&quot;);</span><br><span class="line"></span><br><span class="line">    // value放在指定值pivot的前面</span><br><span class="line">    operations.leftPush(key,&quot;黎明&quot;, &quot;刘汝清&quot;);</span><br><span class="line"></span><br><span class="line">    // value放在指定值pivot的后面</span><br><span class="line">    operations.rightPush(key, &quot;周杰伦&quot;, &quot;兰龙雨&quot;);</span><br><span class="line">    // 获取list的范围值 start, end是索引。</span><br><span class="line">    // end是-1表示获取全部</span><br><span class="line">    List&lt;Serializable&gt; values = operations.range(key, 0, -1);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;values == &quot; + JSONObject.toJSONString(values));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void testListPushAll() &#123;</span><br><span class="line">    ListOperations&lt;String, Serializable&gt; operations =redisTemplate.opsForList();</span><br><span class="line">    String key = &quot;user:fans:2&quot;;</span><br><span class="line"></span><br><span class="line">    // 删除</span><br><span class="line">    redisTemplate.delete(key);</span><br><span class="line">    // 左push</span><br><span class="line">    operations.leftPushAll(key, &quot;刘德华&quot;, &quot;张学友&quot;);</span><br><span class="line">    operations.leftPushAll(key, Lists.newArrayList(&quot;郭富城&quot;, &quot;黎明&quot;));</span><br><span class="line"></span><br><span class="line">    // 右push</span><br><span class="line">    operations.rightPushAll(key, &quot;周杰伦&quot;, &quot;王力宏&quot;);</span><br><span class="line">    operations.rightPushAll(key, Lists.newArrayList(&quot;赵雷&quot;, &quot;李荣浩&quot;));</span><br><span class="line"></span><br><span class="line">    List&lt;Serializable&gt; values = operations.range(key, 0, -1);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;values == &quot; + JSONObject.toJSONString(values));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void testListPushIfPresent() &#123;</span><br><span class="line">    ListOperations&lt;String, Serializable&gt; operations =redisTemplate.opsForList();</span><br><span class="line"></span><br><span class="line">    String key = &quot;user:fans:3&quot;;</span><br><span class="line">    String key2 = &quot;user:fans:2&quot;;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * leftPushIfPresent当key有值的时候，左边添加。否则不做任何操作</span><br><span class="line">     */</span><br><span class="line">    operations.leftPushIfPresent(key, &quot;周杰伦&quot;);</span><br><span class="line">    operations.leftPushIfPresent(key, &quot;王力宏&quot;);</span><br><span class="line">    operations.leftPushIfPresent(key, &quot;王力宏&quot;);</span><br><span class="line"></span><br><span class="line">    operations.leftPushIfPresent(key2, &quot;周杰伦&quot;);</span><br><span class="line">    operations.leftPushIfPresent(key2, &quot;王力宏&quot;);</span><br><span class="line">    operations.leftPushIfPresent(key2, &quot;王力宏&quot;);</span><br><span class="line"></span><br><span class="line">    // rightPushIfPresent当key有值的时候，左边添加。否则不做任何操作</span><br><span class="line">    operations.rightPushIfPresent(key2, &quot;王力宏&quot;);</span><br><span class="line"></span><br><span class="line">    List&lt;Serializable&gt; values = operations.range(key, 0, -1);</span><br><span class="line">    System.out.println(&quot;key values == &quot; + JSONObject.toJSONString(values));</span><br><span class="line">    // key2</span><br><span class="line">    System.out.println(&quot;key2 values == &quot; + JSONObject.toJSONString(operations.range(key2, 0, -1)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void testListPop() &#123;</span><br><span class="line">    ListOperations&lt;String, Serializable&gt; operations =redisTemplate.opsForList();</span><br><span class="line">    String key = &quot;user:fans:2&quot;;</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;old values == &quot; + JSONObject.toJSONString(operations.range(key, 0, -1)));</span><br><span class="line"></span><br><span class="line">    // 左删除</span><br><span class="line">    String leftValue = (String) operations.leftPop(key);</span><br><span class="line"></span><br><span class="line">    // 右删除</span><br><span class="line">    String rightValue = (String) operations.rightPop(key);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;left value == &quot; + leftValue);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;right value == &quot; + rightValue);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;current values == &quot; + JSONObject.toJSONString(operations.range(key, 0, -1)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void testListRemove() &#123;</span><br><span class="line">    ListOperations&lt;String, Serializable&gt; operations =redisTemplate.opsForList();</span><br><span class="line">    String key = &quot;user:fans:2&quot;;</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;old values == &quot; + JSONObject.toJSONString(operations.range(key, 0, -1)));</span><br><span class="line"></span><br><span class="line">    operations.leftPush(key, &quot;张学友&quot;);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;old values == &quot; + JSONObject.toJSONString(operations.range(key, 0, -1)));</span><br><span class="line">    // 指定个数count删除与value的值</span><br><span class="line">    Long successNum = operations.remove(key, 100, &quot;张学友&quot;);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;successNum == &quot; + successNum);</span><br><span class="line">    System.out.println(&quot;current values == &quot; + JSONObject.toJSONString(operations.range(key, 0, -1)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void testListRightPopAndLeftPush() &#123;</span><br><span class="line">    ListOperations&lt;String, Serializable&gt; operations =redisTemplate.opsForList();</span><br><span class="line">    String key = &quot;user:fans:2&quot;;</span><br><span class="line">    String destinationKey = &quot;user:fans:5&quot;;</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;key values == &quot; + JSONObject.toJSONString(operations.range(key, 0, -1)));</span><br><span class="line">    System.out.println(&quot;destinationKey values == &quot; + JSONObject.toJSONString(operations.range(destinationKey, 0, -1)));</span><br><span class="line"></span><br><span class="line">    // 从源list删除，放入目标list的左边</span><br><span class="line">    operations.rightPopAndLeftPush(key, destinationKey);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;current key values == &quot; + JSONObject.toJSONString(operations.range(key, 0, -1)));</span><br><span class="line">    System.out.println(&quot;current destinationKey values == &quot; + JSONObject.toJSONString(operations.range(destinationKey, 0, -1)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void testListRightPopAndLeftPushWithTimeout() &#123;</span><br><span class="line">    ListOperations&lt;String, Serializable&gt; operations =redisTemplate.opsForList();</span><br><span class="line">    String key = &quot;user:fans:6&quot;;</span><br><span class="line">    String destinationKey = &quot;user:fans:5&quot;;</span><br><span class="line"></span><br><span class="line">    // 先删除，以防有值</span><br><span class="line">    redisTemplate.delete(key);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;key values == &quot; + JSONObject.toJSONString(operations.range(key, 0, -1)));</span><br><span class="line">    System.out.println(&quot;destinationKey values == &quot; + JSONObject.toJSONString(operations.range(destinationKey, 0, -1)));</span><br><span class="line"></span><br><span class="line">    Long size = operations.size(destinationKey);</span><br><span class="line">    System.out.println(&quot;size == &quot; + size);</span><br><span class="line"></span><br><span class="line">    Long start = System.currentTimeMillis();</span><br><span class="line">    // 从源list删除，放入目标list的左边</span><br><span class="line">    operations.rightPopAndLeftPush(key, destinationKey, 2, TimeUnit.SECONDS);</span><br><span class="line"></span><br><span class="line">    Long end = System.currentTimeMillis();</span><br><span class="line">    System.out.println(&quot;耗时：&quot; + (end - start)/1000 + &quot;s&quot;);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;current key values == &quot; + JSONObject.toJSONString(operations.range(key, 0, -1)));</span><br><span class="line">    System.out.println(&quot;current destinationKey values == &quot; + JSONObject.toJSONString(operations.range(destinationKey, 0, -1)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void testListSet() &#123;</span><br><span class="line">    ListOperations&lt;String, Serializable&gt; operations =redisTemplate.opsForList();</span><br><span class="line">    String key = &quot;user:fans:5&quot;;</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;key values == &quot; + JSONObject.toJSONString(operations.range(key, 0, -1)));</span><br><span class="line"></span><br><span class="line">    // 修改指定下标的值，如果下标超过list范围会报错</span><br><span class="line">    operations.set(key, 1, &quot;张学友&quot;);</span><br><span class="line">//        operations.set(key, 3, &quot;张学友&quot;);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;key values == &quot; + JSONObject.toJSONString(operations.range(key, 0, -1)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void testListTrim() &#123;</span><br><span class="line">    ListOperations&lt;String, Serializable&gt; operations =redisTemplate.opsForList();</span><br><span class="line">    String key = &quot;user:fans:5&quot;;</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;key values == &quot; + JSONObject.toJSONString(operations.range(key, 0, -1)));</span><br><span class="line"></span><br><span class="line">    // 保留下标从start到end的值</span><br><span class="line">    operations.trim(key, 0, 1);</span><br><span class="line"></span><br><span class="line">    // 指定key过期时间</span><br><span class="line">    redisTemplate.expire(key, 2, TimeUnit.SECONDS);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;key values == &quot; + JSONObject.toJSONString(operations.range(key, 0, -1)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="HashOperations"><a href="#HashOperations" class="headerlink" title="HashOperations"></a>HashOperations</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"> @Test</span><br><span class="line">public void testHashPut() &#123;</span><br><span class="line">    HashOperations&lt;String, String, Serializable&gt; operations =redisTemplate.opsForHash();</span><br><span class="line">    String key = &quot;userInfo:1&quot;;</span><br><span class="line"></span><br><span class="line">    String hashKeyMobile = &quot;mobile&quot;;</span><br><span class="line">    String hashKeyPassword = &quot;password&quot;;</span><br><span class="line"></span><br><span class="line">    // 设值</span><br><span class="line">    operations.put(key, hashKeyMobile, &quot;13127787865&quot;);</span><br><span class="line">    operations.put(key, hashKeyPassword, &quot;123456&quot;);</span><br><span class="line"></span><br><span class="line">    // 根据key和hashKey获取值</span><br><span class="line">    System.out.println(&quot;mobile == &quot; + operations.get(key, hashKeyMobile));</span><br><span class="line">    System.out.println(&quot;password == &quot; + operations.get(key, hashKeyPassword));</span><br><span class="line"></span><br><span class="line">    // 根据key和hashKey的集合获取值</span><br><span class="line">    List&lt;Serializable&gt; listValues = operations.multiGet(key, Lists.newArrayList(hashKeyMobile, hashKeyPassword));</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;listValues == &quot; + JSONObject.toJSONString(listValues));</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void testHashPutAll() &#123;</span><br><span class="line">    HashOperations&lt;String, String, Serializable&gt; operations =redisTemplate.opsForHash();</span><br><span class="line">    String key = &quot;userInfo:2&quot;;</span><br><span class="line"></span><br><span class="line">    String key3 = &quot;userInfo:3&quot;;</span><br><span class="line"></span><br><span class="line">    String hashKeyMobile = &quot;mobile&quot;;</span><br><span class="line">    String hashKeyPassword = &quot;password&quot;;</span><br><span class="line">    String hashKeyEmail = &quot;email&quot;;</span><br><span class="line"></span><br><span class="line">    Map&lt;String, Serializable&gt; map = ImmutableMap.of(</span><br><span class="line">            hashKeyMobile, &quot;13127787865&quot;,</span><br><span class="line">            hashKeyPassword, &quot;123456&quot;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    // 设值map</span><br><span class="line">    operations.putAll(key, map);</span><br><span class="line"></span><br><span class="line">    // 如果key值存在，在key中hashKey也存在，不做处理，</span><br><span class="line">    // 如果key值存在，hashKey不存在，在key中可以添加不存在的的键值对，</span><br><span class="line">    operations.putIfAbsent(key, hashKeyMobile, &quot;13127787866&quot;);</span><br><span class="line">    operations.putIfAbsent(key, hashKeyEmail, &quot;diaoxingguo@odianyun.com&quot;);</span><br><span class="line">    // 如果key不存在，则新增一个key，同时将键值对hashKey和hashValue添加到该key中。</span><br><span class="line">    operations.putIfAbsent(key3, hashKeyMobile, &quot;13127787866&quot;);</span><br><span class="line"></span><br><span class="line">    // 根据key和hashKey获取值</span><br><span class="line">    System.out.println(&quot;mobile == &quot; + operations.get(key, hashKeyMobile));</span><br><span class="line">    System.out.println(&quot;password == &quot; + operations.get(key, hashKeyPassword));</span><br><span class="line">    System.out.println(&quot;email == &quot; + operations.get(key, hashKeyEmail));</span><br><span class="line"></span><br><span class="line">    // 根据key和hashKey的集合获取值</span><br><span class="line">    List&lt;Serializable&gt; listValues = operations.multiGet(key, Lists.newArrayList(hashKeyMobile, hashKeyPassword, hashKeyEmail));</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;listValues == &quot; + JSONObject.toJSONString(listValues));</span><br><span class="line"></span><br><span class="line">    // operations.entries获取hashKey和hashValue</span><br><span class="line">    Map&lt;String, Serializable&gt; hashKeyValueMap = operations.entries(key);</span><br><span class="line">    Map&lt;String, Serializable&gt; hashKeyValueMap3 = operations.entries(key3);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;hashKeyValueMap == &quot; + JSONObject.toJSONString(hashKeyValueMap));</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;hashKeyValueMap3 == &quot; + JSONObject.toJSONString(hashKeyValueMap3));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void testHashHasKey() &#123;</span><br><span class="line">    HashOperations&lt;String, String, Serializable&gt; operations =redisTemplate.opsForHash();</span><br><span class="line">    String key = &quot;userInfo:2&quot;;</span><br><span class="line">    String hashKeyMobile = &quot;mobile&quot;;</span><br><span class="line">    String hashKeyPassword = &quot;password&quot;;</span><br><span class="line">    String hashKeyEmail = &quot;email&quot;;</span><br><span class="line"></span><br><span class="line">    // 是否有hashKey，返回true或者false</span><br><span class="line">    Boolean hasKey = operations.hasKey(key, hashKeyMobile);</span><br><span class="line">    System.out.println(&quot;hasKey == &quot; + hasKey);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;hashKeyValueMap == &quot; + JSONObject.toJSONString(operations.entries(key)));</span><br><span class="line"></span><br><span class="line">    // 删除hashKey,返回成功的个数</span><br><span class="line">    Long deleteNum = operations.delete(key, hashKeyMobile, &quot;nickname&quot;);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;deleteNum == &quot; + deleteNum);</span><br><span class="line">    System.out.println(&quot;hasKey == &quot; + operations.hasKey(key, hashKeyMobile));</span><br><span class="line">    System.out.println(&quot;hashKeyValueMap == &quot; + JSONObject.toJSONString(operations.entries(key)));</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void testHashKeys() &#123;</span><br><span class="line">    HashOperations&lt;String, String, Serializable&gt; operations =redisTemplate.opsForHash();</span><br><span class="line">    String key = &quot;userInfo:2&quot;;</span><br><span class="line"></span><br><span class="line">    // 获取key中hashKey的集合</span><br><span class="line">    Set&lt;String&gt; hashKeySet = operations.keys(key);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;hashKeySet == &quot; + JSONObject.toJSONString(hashKeySet));</span><br><span class="line"></span><br><span class="line">    // 获取key中hashValue的集合</span><br><span class="line">    List&lt;Serializable&gt; hashValueList = operations.values(key);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;hashValueList == &quot; + JSONObject.toJSONString(hashValueList));</span><br><span class="line"></span><br><span class="line">    // 获取key中hashKey的个数</span><br><span class="line">    Long hashKeySize = operations.size(key);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;hashKeySize == &quot; + JSONObject.toJSONString(hashKeySize));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void testHashIncrement() &#123;</span><br><span class="line">    HashOperations&lt;String, String, Integer&gt; operations =redisTemplate.opsForHash();</span><br><span class="line">    String key = &quot;user:visit:3&quot;;</span><br><span class="line">    for (int i=0; i&lt;10; i++)&#123;</span><br><span class="line">        System.out.println(&quot;result score == &quot; + operations.increment(key, &quot;pv&quot;, 2));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="redisTemplate超时失效"><a href="#redisTemplate超时失效" class="headerlink" title="redisTemplate超时失效"></a>redisTemplate超时失效</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testHash() throws InterruptedException &#123;</span><br><span class="line">    String key = &quot;so:1&quot;;</span><br><span class="line">    HashOperations&lt;String, String, Object&gt; operations = redisTemplate.opsForHash();</span><br><span class="line"></span><br><span class="line">    operations.put(key, &quot;orderCode&quot;, &quot;1&quot;);</span><br><span class="line">    operations.put(key, &quot;userId&quot;, &quot;2&quot;);</span><br><span class="line">    String orderCode = (String) operations.get(key, &quot;orderCode&quot;);</span><br><span class="line">    Map&lt;String, Object&gt; map = operations.entries(key);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;orderCode = &quot; + orderCode);</span><br><span class="line">    System.out.println(&quot;map = &quot; + JSONObject.toJSONString(map));</span><br><span class="line">    // 超时失效</span><br><span class="line">    redisTemplate.expire(key, 1, TimeUnit.SECONDS);</span><br><span class="line">    Thread.sleep(1500);</span><br><span class="line"></span><br><span class="line">    List&lt;Object&gt; list = operations.multiGet(key, Lists.newArrayList(&quot;orderCode&quot;, &quot;userId&quot;));</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;list = &quot; + JSONObject.toJSONString(list));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="SetOperations"><a href="#SetOperations" class="headerlink" title="SetOperations"></a>SetOperations</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br></pre></td><td class="code"><pre><span class="line">    /**</span><br><span class="line">     * 给集合key添加多个值，集合不存在创建后再添加</span><br><span class="line">     *</span><br><span class="line">     * @param key 不能为null</span><br><span class="line">     * @param values</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    Long add(K key, V... values);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 移除集合中多个value值</span><br><span class="line">     * @param key 不能为null</span><br><span class="line">     * @param values</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    Long remove(K key, Object... values);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 随机删除集合中的一个值，并返回。</span><br><span class="line">     *</span><br><span class="line">     * @param key 不能为null</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    V pop(K key);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 把源集合中的一个元素移动到目标集合。成功返回true.</span><br><span class="line">     *</span><br><span class="line">     * @param key 不能为null</span><br><span class="line">     * @param value</span><br><span class="line">     * @param destKey must not be &#123;@literal null&#125;.</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    Boolean move(K key, V value, K destKey);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回结合的大小</span><br><span class="line">     *</span><br><span class="line">     * @param key 不能为null</span><br><span class="line">     * @return</span><br><span class="line">     * @see &lt;a href=&quot;http://redis.io/commands/scard&quot;&gt;Redis Documentation: SCARD&lt;/a&gt;</span><br><span class="line">     */</span><br><span class="line">    Long size(K key);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 检查集合中是否包含某个元素</span><br><span class="line">     *</span><br><span class="line">     * @param key 不能为null</span><br><span class="line">     * @param o</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    Boolean isMember(K key, Object o);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 求指定集合与另一个集合的交集</span><br><span class="line">     *</span><br><span class="line">     * @param key 不能为null</span><br><span class="line">     * @param otherKey must not be &#123;@literal null&#125;.</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    Set&lt;V&gt; intersect(K key, K otherKey);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *求指定集合与另外多个个集合交集</span><br><span class="line">     *</span><br><span class="line">     * @param key 不能为null</span><br><span class="line">     * @param otherKeys 不能为null</span><br><span class="line">     * @return</span><br><span class="line">     * @see &lt;a href=&quot;http://redis.io/commands/sinter&quot;&gt;Redis Documentation: SINTER&lt;/a&gt;</span><br><span class="line">     */</span><br><span class="line">    Set&lt;V&gt; intersect(K key, Collection&lt;K&gt; otherKeys);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 求指定集合与另一个集合的交集，并且存储到目标集合中</span><br><span class="line">     *</span><br><span class="line">     * @param key 不能为null</span><br><span class="line">     * @param otherKey 不能为null</span><br><span class="line">     * @param destKey 不能为null</span><br><span class="line">     * @return 返回目标集合的长度</span><br><span class="line">     */</span><br><span class="line">    Long intersectAndStore(K key, K otherKey, K destKey);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 求指定集合与另外多个集合中的交集保存到目标集合</span><br><span class="line">     *</span><br><span class="line">     * @param key 不能为null</span><br><span class="line">     * @param otherKeys 不能为null</span><br><span class="line">     * @param destKey 不能为null</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    Long intersectAndStore(K key, Collection&lt;K&gt; otherKeys, K destKey);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 求指定集合与另一个集合的并集 并返回并集</span><br><span class="line">     *</span><br><span class="line">     * @param key 不能为null</span><br><span class="line">     * @param otherKey 不能为null</span><br><span class="line">     * @return</span><br><span class="line">     * @see &lt;a href=&quot;http://redis.io/commands/sunion&quot;&gt;Redis Documentation: SUNION&lt;/a&gt;</span><br><span class="line">     */</span><br><span class="line">    Set&lt;V&gt; union(K key, K otherKey);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 求指定集合与另外多个集合的并集 并返回并集</span><br><span class="line">     *</span><br><span class="line">     * @param key 不能为null</span><br><span class="line">     * @param otherKeys 不能为null</span><br><span class="line">     * @return</span><br><span class="line">     * @see &lt;a href=&quot;http://redis.io/commands/sunion&quot;&gt;Redis Documentation: SUNION&lt;/a&gt;</span><br><span class="line">     */</span><br><span class="line">    Set&lt;V&gt; union(K key, Collection&lt;K&gt; otherKeys);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *求指定集合与另一个集合的并集，并保存到目标集合</span><br><span class="line">     */</span><br><span class="line">    Long unionAndStore(K key, K otherKey, K destKey);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *求指定集合与另外多个集合的并集，并保存到目标集合</span><br><span class="line">     */</span><br><span class="line">    Long unionAndStore(K key, Collection&lt;K&gt; otherKeys, K destKey);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 求指定集合与另一个集合的差集</span><br><span class="line">     */</span><br><span class="line">    Set&lt;V&gt; difference(K key, K otherKey);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 求指定集合与另外多个集合的差集</span><br><span class="line">     */</span><br><span class="line">    Set&lt;V&gt; difference(K key, Collection&lt;K&gt; otherKeys);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 求指定集合与另一个集合的差集，并保存到目标集合</span><br><span class="line">     */</span><br><span class="line">    Long differenceAndStore(K key, K otherKey, K destKey);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 求指定集合与另外多个集合的差集，并保存到目标集合</span><br><span class="line">     */</span><br><span class="line">    Long differenceAndStore(K key, Collection&lt;K&gt; otherKeys, K destKey);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取集合中的所有元素</span><br><span class="line">     */</span><br><span class="line">    Set&lt;V&gt; members(K key);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 随机获取集合中的一个元素</span><br><span class="line">     */</span><br><span class="line">    V randomMember(K key);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 随机返回集合中指定数量的元素</span><br><span class="line">     */</span><br><span class="line">    List&lt;V&gt; randomMembers(K key, long count);</span><br><span class="line"> @Test</span><br><span class="line">public void testSetAdd() &#123;</span><br><span class="line">    SetOperations&lt;String, Serializable&gt; operations = redisTemplate.opsForSet();</span><br><span class="line">    String key = &quot;user:label:1&quot;;</span><br><span class="line">    // 添加单个值</span><br><span class="line">    operations.add(key, &quot;帅气&quot;);</span><br><span class="line">    operations.add(key, &quot;大方&quot;);</span><br><span class="line"></span><br><span class="line">    // 添加多个值</span><br><span class="line">    operations.add(key, &quot;帅气&quot;, &quot;善良&quot;, &quot;高&quot;, &quot;富&quot;);</span><br><span class="line"></span><br><span class="line">    // 获取set中的值集合</span><br><span class="line">    Set&lt;Serializable&gt; values = operations.members(key);</span><br><span class="line">    System.out.println(&quot;values == &quot; + values);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;是否含有：富 == &quot; + operations.isMember(key, &quot;富&quot;));</span><br><span class="line">    System.out.println(&quot;是否含有：穷 == &quot; + operations.isMember(key, &quot;穷&quot;));</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void testSetRandom() &#123;</span><br><span class="line">    SetOperations&lt;String, Serializable&gt; operations = redisTemplate.opsForSet();</span><br><span class="line">    String key = &quot;user:label:1&quot;;</span><br><span class="line"></span><br><span class="line">    // 按照count个数随机返回，有可能有重复值</span><br><span class="line">    List&lt;Serializable&gt; randomList = operations.randomMembers(key, 3);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;randomList == &quot; + JSONObject.toJSONString(randomList));</span><br><span class="line"></span><br><span class="line">    // 按照count个数随机返回，没有重复值</span><br><span class="line">    Set&lt;Serializable&gt; distinctRandomSet = operations.distinctRandomMembers(key, 3);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;distinctRandomSet == &quot; + JSONObject.toJSONString(distinctRandomSet));</span><br><span class="line"></span><br><span class="line">    // 随机返回一个值</span><br><span class="line">    String randomValue = (String) operations.randomMember(key);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;randomValue == &quot; + randomValue);</span><br><span class="line"></span><br><span class="line">    // 获取key对应值的个数</span><br><span class="line">    System.out.println(&quot;size == &quot; + operations.size(key));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void testSetMove() &#123;</span><br><span class="line">    SetOperations&lt;String, Serializable&gt; operations = redisTemplate.opsForSet();</span><br><span class="line">    String key = &quot;user:label:1&quot;;</span><br><span class="line">    String key2 = &quot;user:label:2&quot;;</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;values == &quot; + operations.members(key));</span><br><span class="line">    // 移除给定的值，返回成功的个数</span><br><span class="line">    Long successNum = operations.remove(key, &quot;高&quot;, &quot;穷&quot;);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;successNum == &quot; + successNum);</span><br><span class="line">    System.out.println(&quot;values == &quot; + operations.members(key));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    operations.move(key, &quot;富&quot;, key2);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;values == &quot; + operations.members(key));</span><br><span class="line">    System.out.println(&quot;values == &quot; + operations.members(key2));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void testSetIntersect() &#123;</span><br><span class="line">    SetOperations&lt;String, Serializable&gt; operations = redisTemplate.opsForSet();</span><br><span class="line">    String key = &quot;user:label:3&quot;;</span><br><span class="line">    String key2 = &quot;user:label:4&quot;;</span><br><span class="line">    String key3 = &quot;user:label:5&quot;;</span><br><span class="line">    String key4 = &quot;user:label:6&quot;;</span><br><span class="line">    String key5 = &quot;user:label:7&quot;;</span><br><span class="line"></span><br><span class="line">    operations.add(key, &quot;帅&quot;, &quot;善良&quot;, &quot;高&quot;, &quot;富&quot;);</span><br><span class="line">    operations.add(key2, &quot;帅&quot;, &quot;善良&quot;, &quot;高&quot;, &quot;富&quot;, &quot;才华&quot;, &quot;白&quot;);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;values == &quot; + operations.members(key));</span><br><span class="line">    System.out.println(&quot;values == &quot; + operations.members(key2));</span><br><span class="line"></span><br><span class="line">    // 取交集并返回</span><br><span class="line">    Set&lt;Serializable&gt; intersectSet = operations.intersect(key, key2);</span><br><span class="line"></span><br><span class="line">    // 取key和key2的交集赋给key3</span><br><span class="line">    operations.intersectAndStore(key, key2, key3);</span><br><span class="line"></span><br><span class="line">    // 取key和key2的并集并返回</span><br><span class="line">    Set&lt;Serializable&gt; unionSet = operations.union(key, key2);</span><br><span class="line"></span><br><span class="line">    // 取key和key2的并集赋给key3</span><br><span class="line">    operations.unionAndStore(key, key2, key3);</span><br><span class="line"></span><br><span class="line">    // key对key2求差赋给key4</span><br><span class="line">    operations.differenceAndStore(key, key2, key4);</span><br><span class="line">    // key2对key求差赋给key5</span><br><span class="line">    operations.differenceAndStore(key2, key, key5);</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;intersectSet == &quot; + JSONObject.toJSONString(intersectSet));</span><br><span class="line">    System.out.println(&quot;unionSet == &quot; + JSONObject.toJSONString(unionSet));</span><br><span class="line">    System.out.println(&quot;key3 == &quot; + JSONObject.toJSONString(operations.members(key3)));</span><br><span class="line">    System.out.println(&quot;key4 == &quot; + JSONObject.toJSONString(operations.members(key4)));</span><br><span class="line">    System.out.println(&quot;key5 == &quot; + JSONObject.toJSONString(operations.members(key5)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ZSetOperations"><a href="#ZSetOperations" class="headerlink" title="ZSetOperations"></a>ZSetOperations</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testZSetAdd() &#123;</span><br><span class="line">    ZSetOperations&lt;String, Serializable&gt; operations =redisTemplate.opsForZSet();</span><br><span class="line">    String key = &quot;weibo:hot&quot;;</span><br><span class="line">    // 添加值</span><br><span class="line">    operations.add(key, &quot;郑州&quot;, 100);</span><br><span class="line">    operations.add(key, &quot;开封&quot;, 90);</span><br><span class="line">    operations.add(key, &quot;登封&quot;, 95);</span><br><span class="line">    operations.add(key, &quot;巩义&quot;, 85);</span><br><span class="line">    operations.add(key, &quot;中牟&quot;, 89);</span><br><span class="line"></span><br><span class="line">    // 获取值的范围，end = -1表示全部,从小到大</span><br><span class="line">    Set&lt;Serializable&gt; valueSet = operations.range(key, 0, -1);</span><br><span class="line">    System.out.println(&quot;valueSet == &quot; + valueSet);</span><br><span class="line"></span><br><span class="line">    // 获取值的范围，end = -1表示全部,从大到小</span><br><span class="line">    Set&lt;Serializable&gt; valueReverseSet = operations.reverseRange(key, 0, -1);</span><br><span class="line">    System.out.println(&quot;valueReverseSet == &quot; + valueReverseSet);</span><br><span class="line"></span><br><span class="line">    // 获取分数从min到max之间,从小到大</span><br><span class="line">    System.out.println(&quot;rangeByScore == &quot; + operations.rangeByScore(key, 90, 100));</span><br><span class="line">    // 获取分数从min到max之间,从大到小</span><br><span class="line">    System.out.println(&quot;reverseRangeByScore&quot; + operations.reverseRangeByScore(key, 90, 100));</span><br><span class="line"></span><br><span class="line">    // 获取下标，排序从小到大</span><br><span class="line">    System.out.println(&quot;rank == &quot; + operations.rank(key, &quot;开封&quot;));</span><br><span class="line">    // 获取下标，排序从大到小</span><br><span class="line">    System.out.println(&quot;reverseRank == &quot; + operations.reverseRank(key, &quot;开封&quot;));</span><br><span class="line">    // 获取分数从min到max的总数</span><br><span class="line">    System.out.println(&quot;count == &quot; + operations.count(key,90, 100));</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="作业"><a href="#作业" class="headerlink" title="作业"></a>作业</h2><p>表：code，只需要查中文的language &#x3D; zh_CN，is_deleted &#x3D;0</p>
<h3 id="List-listByCategory-String-pool-String-category"><a href="#List-listByCategory-String-pool-String-category" class="headerlink" title="List listByCategory(String pool, String category)"></a>List<Code> listByCategory(String pool, String category)</h3><p>根据pool和category获取category中的列表返回值包含code和name(使用缓存)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">        `code`,</span><br><span class="line">        `name` </span><br><span class="line">FROM</span><br><span class="line">        `code` </span><br><span class="line">WHERE</span><br><span class="line">        LANGUAGE = &#x27;zh_CN&#x27; </span><br><span class="line">        AND is_deleted = 0 </span><br><span class="line">        AND pool = &#x27;opms&#x27; </span><br><span class="line">        AND category = &#x27;CONTRACT_CHANGE_USER_TYPE&#x27;;</span><br></pre></td></tr></table></figure>

<h3 id="String-getNameByCode-String-pool-String-category-String-code"><a href="#String-getNameByCode-String-pool-String-category-String-code" class="headerlink" title="String getNameByCode(String pool,  String category , String code)"></a>String getNameByCode(String pool,  String category , String code)</h3><p>根据pool，category，code获取name(使用缓存)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">        `code`,</span><br><span class="line">        `name` </span><br><span class="line">FROM</span><br><span class="line">        `code` </span><br><span class="line">WHERE</span><br><span class="line">        LANGUAGE = &#x27;zh_CN&#x27; </span><br><span class="line">        AND is_deleted = 0 </span><br><span class="line">        AND pool = &#x27;opms&#x27; </span><br><span class="line">        AND category = &#x27;CONTRACT_CHANGE_USER_TYPE&#x27;</span><br><span class="line">        AND `code` = 1;</span><br></pre></td></tr></table></figure>



<h3 id="修改和获取用户标签"><a href="#修改和获取用户标签" class="headerlink" title="修改和获取用户标签"></a>修改和获取用户标签</h3><p>表：u_user_identity</p>
<p>字段：ext_field1，存放的数据类型是json数组。例如：["高"， "富"]</p>
<ul>
<li>提供更新接口。更新时，更新u_user_identity.ext_field1，同时更新缓存</li>
<li>提供获取标签接口。获取时，先从缓存获取，如果缓存没有从表里获取。缓存有效时间5分钟</li>
</ul>
<h3 id="热搜"><a href="#热搜" class="headerlink" title="热搜"></a>热搜</h3><p>提供test用例</p>
<ul>
<li><p>可以修改热搜的排名</p>
</li>
<li><p>获取10条热搜，支持正序和反序</p>
</li>
<li><p>可以删除热搜</p>
</li>
</ul>
<p>redis缓存机制可以控制一个用户只能点赞一次</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public String addLike(String id, LikeInfo likeInfos) &#123;</span><br><span class="line">        Query query = new Query(Criteria.where(&quot;_id&quot;).is(id));</span><br><span class="line">        likeInfos.setId(idUtils.getRentId());</span><br><span class="line">        //likeInfos.setUserId(idUtils.getRentId());</span><br><span class="line">        String userId=likeInfos.getUserId();</span><br><span class="line">        if(redisTemplate.opsForValue().get(&quot;likeInfos&quot;+userId)!=null)&#123;</span><br><span class="line">            return &quot;请不要重复点赞&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        Update update = new Update();</span><br><span class="line">        update.push(&quot;likeInfo&quot;, likeInfos);</span><br><span class="line">        mongoTemplate.updateFirst(query, update, Article.class);</span><br><span class="line">        redisTemplate.opsForValue().set(&quot;likeInfos&quot;+userId,&quot;已点赞&quot;);</span><br><span class="line">        return &quot;点赞成功&quot;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/06/26/%E7%AC%AC%E4%B9%9D%E8%8A%82%EF%BC%9Aspringboot%E9%9B%86%E6%88%90redis%E5%8F%8A%E4%BD%BF%E7%94%A8/" data-id="cl4vgwmaa000tu8gvb11ngpot" data-title="" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2022/06/26/%E8%AE%A2%E5%8D%95%E4%B8%9A%E5%8A%A1%E6%93%8D%E4%BD%9C%E6%B5%81%E7%A8%8B/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/2022/06/26/Windows/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title"></div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/06/26/RabbitMQ%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/">(no title)</a>
          </li>
        
          <li>
            <a href="/2022/06/26/redis/">(no title)</a>
          </li>
        
          <li>
            <a href="/2022/06/26/Nginx/">(no title)</a>
          </li>
        
          <li>
            <a href="/2022/06/26/PMO%E6%9D%83%E9%99%90%E8%AE%BE%E8%AE%A1/">(no title)</a>
          </li>
        
          <li>
            <a href="/2022/06/26/ody-db/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2022 shangguandanyu<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>