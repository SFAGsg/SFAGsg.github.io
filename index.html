
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="阿SFAG的个人博客">
    <title>阿SFAG的个人博客</title>
    <meta name="author" content="shangguandanyu">
    
    
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"Website","@id":"http://example.com","author":{"@type":"Person","name":"shangguandanyu","sameAs":["https://github.com/","http://stackoverflow.com/users","https://twitter.com/","https://facebook.com/","https://plus.google.com/","https://www.linkedin.com/profile/","mailto"]},"name":"阿SFAG的个人博客","description":"","url":"http://example.com"}</script>
    <meta property="og:type" content="blog">
<meta property="og:title" content="阿SFAG的个人博客">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="阿SFAG的个人博客">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="shangguandanyu">
<meta name="twitter:card" content="summary">
    
    
        
    
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/all.css">

    
<link rel="stylesheet" href="/assets/css/jquery.fancybox.css">

    
<link rel="stylesheet" href="/assets/css/thumbs.css">

    
<link rel="stylesheet" href="/assets/css/tranquilpeak.css">

    <!--STYLES END-->
    

    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    

<header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            阿SFAG的个人博客
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
        </a>
    
</header>

            <!-- Define author's picture -->


<nav id="sidebar" data-behavior="1">
    <div class="sidebar-container">
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="Categories"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="Archives"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="Search"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Search</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="http://stackoverflow.com/users"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Stack Overflow"
                        >
                        <i class="sidebar-button-icon fab fa-stack-overflow" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Stack Overflow</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://twitter.com/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Twitter"
                        >
                        <i class="sidebar-button-icon fab fa-twitter" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Twitter</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://facebook.com/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Facebook"
                        >
                        <i class="sidebar-button-icon fab fa-facebook" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://plus.google.com/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Google +"
                        >
                        <i class="sidebar-button-icon fab fa-google-plus" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Google +</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.linkedin.com/profile/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/mailto"
                            
                            rel="noopener"
                            title="Mail"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/atom.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="1"
                 class="
                        hasCoverMetaIn
                        ">
                <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2022/06/26/Docker/"
                            aria-label=": "
                        >
                            (no title)
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2022-06-26T22:10:59+08:00">
	
		    Jun 26, 2022
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">title: Docker</span><br></pre></td></tr></table></figure>

<h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><p>概念：解决了运行环境和配置文件的软件容器，方便做持续集成并有助于整体发布的容器虚拟化技术</p>
<p>作用：透过镜像，将作业系统核心除外，运作应用程序所需要的系统环境，由上而下的，达到应用程序跨平台间的无缝接轨运行，达到一次封装，多处运行</p>
<p>其实就是缩小版，高度浓缩版的小型linux系统</p>
<p>Docker本身是一个容器运行载体或称之为管理引擎，我们把应用程序和配置依赖打包好形成一个可交付的运行环境，这个打包好的运行环境就是image镜像文件，只有通过这个镜像文件才能生成Docker容器。image文件可以看作是容器的模板，Docker根据image文件生成容器之间的实例。同一个image文件，可以生成多个同时运行的容器实例</p>
<p>传统虚拟机技术：</p>
<ul>
<li>资源占用多</li>
<li>冗余步骤多</li>
<li>启动慢</li>
</ul>
<p>Docker和传统虚拟化方式的不同之处：</p>
<ul>
<li>传统虚拟技术是虚拟出一套硬件后，在其上面运行一个完整操作系统，再在该系统上运行所需应用程序</li>
<li>而容器内的应用程序直接运行在宿主的内核，容器内没有自己的内核，也没有硬件虚拟，所以Docker更加轻便</li>
<li>每个容器之间互相隔离，每个容器都有自己的文件系统，容器间进程不会互相影响，能区分计算资源</li>
<li><img src="C:\Users\SFAG\AppData\Roaming\Typora\typora-user-images\image-20210808160355478.png" alt="image-20210808160355478"></li>
</ul>
<p><strong>Docker三要素：</strong></p>
<ul>
<li><p>镜像：即由image文件生成的容器实例，Docker镜像就是一个只读的模板，镜像可以用来创建容器，一个镜像可以创建多个容器</p>
</li>
<li><p>容器：容器是用镜像创建的运行实例，一个容器运行一种服务，容器可以被启动，开始，停止，删除。每个容器都是相互隔离的、保证安全的平台，</p>
<p>可以把容器看成是一个简易版的linux环境和运行在其中的应用程序，容器和镜像的定义几乎一模一样，唯一的区别就是容器最上面的那一层是可读可写的</p>
</li>
<li><p>仓库：仓库是集中存放镜像文件的场所。仓库（repository）和仓库注册服务器（registry）是有区别的，仓库注册服务器往往存放着多个仓库，每个仓库又包含了多个镜像，每个镜像都有不同的标签</p>
<ul>
<li>公开仓库：最大的公开仓库是Docker Hub（<a target="_blank" rel="noopener" href="https://hub.docker.com),存放了数量庞大的镜像供用户下载.国内的公开仓库包括阿里云、网易云等/">https://hub.docker.com），存放了数量庞大的镜像供用户下载。国内的公开仓库包括阿里云、网易云等</a></li>
<li>私有仓库</li>
</ul>
</li>
</ul>
<p>运行步骤：</p>
<ol>
<li>拉取镜像文件到本地</li>
<li>以镜像文件为模板，运行一个容器实例</li>
</ol>
<p><strong>Docker常用命令：</strong></p>
<ol>
<li>辅助命令<ul>
<li>docker version：查看docker版本</li>
<li>docker info：查看docker信息描述</li>
<li>docker –help：查看docker命令帮助</li>
</ul>
</li>
<li>镜像命令<ul>
<li>docker images：列出本地主机上的镜像<ul>
<li>-a：列出本地主机上的所有镜像（包括中间映射层）</li>
<li>-q：列出本地主机上的所有镜像的id</li>
<li>–digests：显示镜像的摘要信息</li>
<li>–no-truncs：显示完整的镜像信息</li>
</ul>
</li>
<li>docker search +镜像名：在dockerHub中查询某镜像文件<ul>
<li>–no-truncs：显示完整的镜像信息<ul>
<li>-s：列出收藏数不小于指定值的镜像</li>
<li>–automated：只列出automated bulid类型的镜像</li>
</ul>
</li>
</ul>
</li>
<li>docker pull +镜像名：拉取某镜像文件</li>
<li>docker rmi + 镜像名：删除镜像文件<ul>
<li>-f：强制删除</li>
<li>删除全部镜像：docker rmi -f ${docker images -qa}</li>
</ul>
</li>
</ul>
</li>
<li>容器命令<ul>
<li>docker run +镜像名或镜像id：新建并启动容器<ul>
<li>-i：以交互模式运行容器，通常与-t同时使用</li>
<li>-t：为容器重新输入一个伪输入终端，通常与-i同时使用</li>
<li>-d：后台运行容器，并返回容器id<ul>
<li>-P：随机端口映射：docker run -it -P tomcat</li>
</ul>
</li>
<li>-p：指定端口映射：docker run -it -p 8888:8080 tomcat</li>
<li>–name&#x3D;“名称”：为容器指定一个新名称</li>
</ul>
</li>
<li>docker ps：查看正在运行的容器<ul>
<li>-l：查看上一次运行的容器】</li>
<li>-n +数字：查看前几次运行的容器</li>
<li>-q：静默模式：只显示容器编号</li>
<li>–no-trunc：</li>
</ul>
</li>
<li>exit：退出当前容器</li>
<li>docker start + 容器名或容器id：启动容器 </li>
<li>docker restart   + 容器名或容器id：重启容器</li>
<li>docker stop +  + 容器名或容器id：停止容器</li>
<li>docker kill +  + 容器名或容器id：强制停止容器</li>
<li>docker rm + 容器名或容器id：删除容器； -f：强制删除</li>
<li>docker rm -f ${docker images -qa} 或docker ps -aq | xargs docker rm：删除多个容器</li>
<li>docker run -d ：守护式启动容器，不进入容器，不发生交互</li>
<li>docker logs -f -t –tail + 数字 + 容器id：查看容器日志<ul>
<li>-t：加入时间戳</li>
<li>-f：跟随最新的日志打印</li>
<li>–tail + 数字：显示最后多少条</li>
</ul>
</li>
<li>docker top + 容器id：查看容器内运行的进程</li>
<li>docker inspect + 容器id：查看容器内部的细节</li>
<li>docker exec -it 容器id bashshell：重新进入容器并以命令行模式进行交互，在容器中打开新的终端，可以启动新的进程</li>
<li>docker attach 容器id：重新进入容器，直接进入容器启动命令的终端，不会启动新的进程</li>
<li>docker cp 容器id ：容器内路径   目的主机路径：在容器内拷贝文件到主机上</li>
<li>docker commit -a “作者信息” -m “备注信息”  + 容器id + 新生成的容器名&#x2F;tags ：提交容器副本使之成为一个新的镜像</li>
</ul>
</li>
</ol>
<p><strong>Docker 镜像：</strong></p>
<p>概念：镜像是一种轻量级的、可执行的独立软件包，用来打包软件运行环境和基于运行环境开发的软件，它包含某个软件所需的所有内容，包括代码、运行时、库、环境变量和配置文件</p>
<p>UnionFS（联合文件系统）：Union文件系统是一种分层 、轻量级且高性能的文件系统，它支持对文件系统的修改作为一次次来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下。Union文件系统是Docker镜像的基础。镜像可以通过分层来继承，基于基础镜像，可以制作各种具体的应用镜像</p>
<p>特性：一次同时加载多个文件系统，但从外面看来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件会包含所有底层的文件和目录</p>
<p>Docker镜像加载原理：</p>
<ul>
<li><p>bootfs（boot file system）主要包含bootloader和kernel，bootloader主要是引导加载kernel，linux刚启动时回家再包bootfs文件系统，在Docker镜像的最底层是bootfs。这一层与典型的linux&#x2F;Unix系统是一样的，包含boot加载器和内核，当boot加载完成之后整个内核就都在内存中了，此时内存的使用权已经由bootfs转交给内核，此时系统也会卸载bootfs</p>
<ul>
<li><p>rootfs：在bootfs之上。包含的就是linux系统中的&#x2F;dev ,   &#x2F;bin等标准目录和文件。rootfs就是各种不同的操作系统发行版，如Ubuntu，centos等，rootfs可以很小，只需要包括最基本的命令、工具和程序库就可以了，所以在Docker中安装的centos镜像文件比较小。对于不同的linux发行版，bootfs是基本一致的，rootfs会有差别。所以不同的发行版可以公共bootfs</p>
</li>
<li><p>镜像文件分层结构：</p>
<p><img src="C:\Users\SFAG\AppData\Roaming\Typora\typora-user-images\image-20210809102621508.png" alt="image-20210809102621508"></p>
</li>
<li><p>docker镜像都是只读的，当容器启动时，一个新的可写层被加载到镜像的顶部。这一层通常被称为“容器层”，“容器层”之下的都称为“镜像层”。</p>
<p><strong>Docker容器数据卷</strong>：就是目录或者文件，存在于一个或多个容器中，由docker挂载到容器，但不属于联合文件系统，因此能绕过Union file System提供一些用于持续存储和共享数据的特性</p>
</li>
</ul>
<p>作用：</p>
<ul>
<li>容器持久化</li>
<li>容器间的继承和数据共享</li>
</ul>
<p>特点：</p>
<ul>
<li>数据卷可以在容器之间共享或重用数据</li>
<li>卷中的更改可以直接生效</li>
<li>数据卷的更改不会包含在镜像的更新中</li>
<li>数据卷的更新一致持续到没有容器使用它为止</li>
<li>容器停止运行后，主机修改数据，数据一样能同步到容器上</li>
</ul>
<p><strong>创建容器数据卷：</strong></p>
<p>使用-v 创建容器数据卷：</p>
<p>docker run -it -v &#x2F;MyDataVolumn:&#x2F;DataVolumnContainer centos  ：运行centos并创建容器数据卷，可读可写</p>
<p>创建带权限的容器数据卷 ：</p>
<p>docker run -it -v &#x2F;MyDataVolumn:&#x2F;DataVolumnContainer <strong>ro</strong> centos：运行centos并创建容器数据卷，只读</p>
<p>使用dockerFile添加容器数据卷</p>
<p><img src="C:\Users\SFAG\AppData\Roaming\Typora\typora-user-images\image-20210809145258349.png" alt="image-20210809145258349"></p>
</li>
</ul>
<p><strong>DockerFile解析：</strong></p>
<p>DockerFile是用来构建Docker镜像的构建文件，是由一系列命令和参数构成的脚本</p>
<p>构建三步骤</p>
<ul>
<li>编写DockerFile文件</li>
<li>docker build 目标文件 -t +新镜像名字：TAG ，获得自定义镜像</li>
<li>运行镜像文件</li>
</ul>
<p>DockerFile内容基础知识：</p>
<ul>
<li>每条保留字指令都必须为大写字母且后面要跟随至少一个参数</li>
<li>指令按照从上到下，顺序执行</li>
<li>#表示注释</li>
<li>每条指令都会创建一个新的镜像层，并对镜像进行提交</li>
</ul>
<p>DockerFile体系结构（保留字指令）：</p>
<ol>
<li>FROM：指定基础镜像</li>
<li>MAINTAINER：镜像维护者的名字和邮箱地址</li>
<li>RUN：容器构建石需要运行的命令</li>
<li>EXPOSE：当前容器对外暴露的端口号</li>
<li>WORKDIR：指定在创建容器后，终端默认登录的进来工作目录，一个落脚点</li>
<li>ENV：用来在构建镜像是设置环境变量</li>
<li>ADD：将宿主机目录下的文件拷贝进镜像且ADD命令会自动处理URL和解压他tar压缩包</li>
<li>COPY：类似ADD，拷贝文件到目标镜像中；将从构建上下文目录中&lt;源路径&gt;的文件&#x2F;目录复制到新的一层镜像内的&lt;目标路径&gt;位置，两种写法<ul>
<li>COPY src dest</li>
<li>COPY [“src” , “dest”]</li>
</ul>
</li>
<li>VOLUME：容器数据卷，用于数据保存和持久化工作</li>
<li>CMD：指定一个容器启动时要运行的命令，dockerFile中可以有多个CMD命令，但是只有最后一个会生效，CMD会被docker run之后的参数替换</li>
<li>ENTRYPOINT：指定一个容器启动时要运行的命令，目的和CMD一样，但是命令不会被覆盖，都会生效 </li>
<li>ONBUILD：当构建一个被继承的DockerFile时运行命令，父镜像在被子继承之后父镜像的onbuild会被触发</li>
</ol>
<p>安装mysql：</p>
<ul>
<li>拉取mysql镜像文件</li>
<li>运行mysql容器</li>
</ul>
<p><img src="C:\Users\SFAG\AppData\Roaming\Typora\typora-user-images\image-20210809192841682.png" alt="image-20210809192841682"></p>
<ul>
<li>进入mysql容器：<img src="C:\Users\SFAG\AppData\Roaming\Typora\typora-user-images\image-20210809201820771.png" alt="image-20210809201820771"></li>
</ul>
<p>安装redis：</p>
<p>docker run -p 6397:6397 -v &#x2F;sfag&#x2F;myredis&#x2F;data:&#x2F;data -v &#x2F;sfag&#x2F;myredis&#x2F;conf&#x2F;redis.conf:&#x2F;usr&#x2F;local&#x2F;etc&#x2F;redis.conf&#x2F;redis.conf -d redis redis-server &#x2F;usr&#x2F;local&#x2F;etc&#x2F;redis.conf&#x2F;redis.conf –appendonly yes</p>
<p>推送镜像文件到云平台：</p>
<ol>
<li>docker login –username registry. cn-hangzhou,aliyuncs.com</li>
<li>docker tag 镜像id  registry cn-hangzhou,aliyuncs.com&#x2F;镜像文件：版本号</li>
<li>docker push registry cn-hangzhou,aliyuncs.com&#x2F;镜像文件：版本号</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1QgnpSqd6DFyWqsfVJp3ePw">https://pan.baidu.com/s/1QgnpSqd6DFyWqsfVJp3ePw</a></p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2022/06/26/Docker/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
            <a
                href="/2022/06/26/Docker/"
                aria-label=": "
            >
                <div class="postShorten-thumbnailimg">
                    <img alt="" src=""/>
                </div>
            </a>
            
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        
        <li class="pagination-number">page 1 of 1</li>
    </ul>
</div>

</section>


                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2022 shangguandanyu. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <h4 id="about-card-name">shangguandanyu</h4>
        
            <div id="about-card-bio"><p>author.bio</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/jquery.js"></script>


<script src="/assets/js/jquery.fancybox.js"></script>


<script src="/assets/js/thumbs.js"></script>


<script src="/assets/js/tranquilpeak.js"></script>

<!--SCRIPTS END-->





    </body>
</html>
